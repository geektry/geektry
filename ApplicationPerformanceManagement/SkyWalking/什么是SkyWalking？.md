# SkyWalking初探

## 什么是SkyWalking？

### 1. 概述

SkyWalking：一个开源的可观测性平台，用于收集、分析、汇总和可视化来自服务和云原生基础设施的数据。SkyWalking提供了一个简单的方法，让你对你的分布式系统有一个清晰的认识，甚至跨云。它更像是一个现代APM，专门为云原生、基于容器和分布式系统设计。

### 2. 为什么用SkyWalking？

SkyWalking为分布式系统的观测和监控提供了解决方案，在很多不同的场景下，SkyWalking都能提供解决方案。首先，和传统的方式一样，SkyWalking提供了Java、C#、Node.js等服务的自动仪器代理，同时提供了Go(暂无)、C++(暂无)等人工仪器SDK。同时，它还提供了Go(暂无)、C++(暂无)的手动仪表SDK。同时随着所需语言的增多，运行时操作代码的风险，云原生基础设施的功能越来越强大，SkyWalking可以使用Service Mesher infra探针来收集数据，以了解整个分布式系统。一般来说，它提供了对**service(s)**、**service instance(s)**、**endpoint(s)**的可观察能力。

今天到处都在使用Service、Instance和Endpoint的概念，我们先来明确一下它们在SkyWalking中的含义。

- **Service**代表了一系列/一组工作负载，它们为传入的请求提供相同的处理行为。当你在使用工具代理或SDK时，你可以给服务定义名称。或者SkyWalking使用你在平台中定义的名称，比如Istio。

- **Service Instance**服务组中的每一个工作负载都被命名为一个实例。就像Kubernetes中的pod一样，它不需要是OS中的单个进程。另外如果你使用的是工具代理，一个实例在OS中其实就是一个真实的进程。
- **Endpoint**是指在某个服务中，传入请求的路径，比如HTTP URI路径或者gRPC服务类+方法签名。

### 3. 架构

SkyWalking在逻辑上被分成4个部分：Probes, Platform backend, Storage 和 UI。

![687474703a2f2f736b7977616c6b696e672e6170616368652e6f72672f6173736574732f6672616d652e6a706567](https://geektry.oss-cn-shanghai.aliyuncs.com/images/687474703a2f2f736b7977616c6b696e672e6170616368652e6f72672f6173736574732f6672616d652e6a706567.jpg)

- **Probes**探针根据不同的来源而不同。它们收集数据并按照SkyWalking的要求重新格式化。
- **Platform backend**平台后台是一个后台，支持集群模式。它是用于聚合、分析和驱动从探针到用户界面的过程流。它还提供了传入格式（如Zipkin的）、存储实现器和集群管理的可插拔功能。你甚至可以通过使用可观察性分析语言来定制聚合和分析。
- **Storage**存储是开放的。你可以选择现有的实现者，如ElasticSearch，H2或由Sharding-Sphere管理的MySQL集群，或者实现你自己的。当然，我们非常感谢您对新的存储实现者的贡献。
- 对于SkyWalking的终端用户来说，**UI**用户界面很酷，功能非常强大。它还可以自定义，以匹配您的自定义后台。

## Probe

### 1. 介绍

在SkyWalking中，probe是指集成在目标系统中的代理或SDK库，负责收集包括跟踪和指标在内的遥测数据。基于目标系统的技术栈，probe可以采用非常不同的方式来实现。但最终它们都是一样的，只是收集并重新格式化数据，然后发送到后端。

在高层中，所有的天游探秘中，有三个典型的群体。

- 基于语言的本地代理。这类代理运行在目标服务的用户空间，就像用户代码的一部分。如SkyWalking Java代理，使用-javaagent命令行参数在运行时操纵代码，操纵的意思是改变和注入用户的代码。另一种代理是利用目标库提供的一些钩子或拦截机制。所以你可以看到，这几种代理是基于语言和库的。

- 服务网探针。Service Mesh探针从服务网中的sidecar、控制面板或代理收集数据。以前的代理只是作为整个集群的入口，但现在有了Service Mesh和sidecar，我们可以在此基础上进行观察。

- 第三方仪器库。SkyWalking接受其他常用仪器库的数据格式。它对数据进行分析，并将其传输到SkyWalking的数据格式中，包括跟踪、指标或两者。该功能首先接受Zipkin span数据。更多信息请参见Receiver的其他跟踪器。

你不需要同时使用基于Language的本地代理和Service Mesh探针，因为它们都会收集指标数据。因此，你的系统会遭受两次有效载荷，分析数据会加倍。

在使用这些探针时，有几种推荐的方式。

只使用基于语言的本地代理。
只使用第三方仪器库，比如Zipkin仪器生态系统。
只使用Service Mesh探针。
在跟踪状态下，使用基于语言的本地代理或第三方仪器库的Service Mesh探针。(高级用法)
另外，我们举例说明一下in tracing状态是什么意思？

在默认情况下，基于语言的原生代理和第三方工具库都会将分布式的痕迹发送到后台，后台对这些痕迹进行分析和聚合。在tracing状态下的意思是，后台将这些tracing视为类似于日志的东西，只需将其保存起来，并建立tracing和指标之间的联系，比如这个tracing属于哪个终端和服务？